# 在线表格填报工具

## 项目简介

在线表格填报工具是一款专为表格清分、填报、汇总设计的轻量化表格管理系统，专注于解决表格的清分填报与汇总问题。无需复杂的账户体系，即可快速实现表格拆分、多人协作填报和自动数据汇总，解决填报者不按要求填写表格、反复修改表格、反复比对拼接表格的痛点，极大提升表格汇总效率。

### ✨ 项目亮点

1. **无需注册账户**：简化使用流程，通过链接即可快速分享和填报，便于紧急情况下的快速清分工作
2. **智能数据验证**：支持设置单元格填报要求（如数据类型、格式约束等），有效避免填报者乱填、误填
3. **动态跟踪与自动合并**：实时跟踪各子表格的填报进展，支持反复修改并自动合并，彻底摆脱传统方式下反复修改合并的繁琐工作

## 功能特性

### 📁 表格管理
- **多格式支持**：兼容 .xls/.xlsx/.csv/.et 格式文件上传
- **智能解析**：自动提取表头和数据行，快速生成可编辑的在线表格
- **灵活拆分**：支持根据指定列或条件自动拆分表格，生成独立的子表格

### 📋 任务管理
- **快速创建**：基于上传表格一键生成处理任务
- **精细配置**：设置任务名称、填报说明和数据验证规则
- **链接分发**：生成可共享的填报链接，无需账户即可访问
- **进度可视化**：实时查看各子任务的填报状态和完成情况

### 🛡️ 数据格式约束
- **单元格级验证**：支持设置数据类型、格式、范围等验证规则
- **操作提示**：实时反馈填写错误，引导正确填报
- **数据隔离**：填报者只能查看和修改分配给自己的子表格数据

### 📊 高效协作
- **在线编辑**：提供类似Excel的编辑体验，支持复制粘贴、公式计算等功能
- **暂存编辑**：允许暂存填写进度，避免数据丢失
- **反复修改**：支持退回修改，允许填报者修改完善
- **一键汇总**：自动合并所有子表格数据，生成完整Excel文件


## 使用指南

### 1. 创建任务

1. 访问首页
2. 点击"加载表格开始任务"按钮
3. 选择要加载的表格文件
4. 等待文件解析完成后，系统会自动跳转至任务生成页面

### 2. 表格拆分、生成任务

1. 在任务生成页面，选择要拆分的列。也可以选择不拆分，单张表
2. 系统会根据选择的列自动拆分表格
3. 确认拆分结果后，点击"下一步"进入条件设置页面

### 3. 设置填报者需遵守的约束条件并完善任务

1. 输入任务名称和填表说明
2. 配置各列验证规则（可选，用于限制数据格式）
3. 点击"上传表格并发布任务"生成填报链接

### 4. 发布和分发任务

1. 在任务发布页面，查看生成的子表格列表
2. 点击"一键导出链接"复制所有子表格的填报链接，或分别将链接分发给相应的填报人员
3. 将链接分发给相应的填报人员
4. 在该页面，还可以对各子表格填报进度进行监控和管理，逾期的可以豁免

### 5. 数据填报

1. 填报人员通过链接访问表格填写页面
2. 按照要求填写表格数据（系统会实时验证数据格式）
3. 填写完成后点击"提交"按钮
4. 可以暂存、还可以还原到原始表格
5. 提交后如果有问题，可以联系任务发布者退回修正
6. 如果已经逾期，可以联系任务发布者申请豁免

### 6. 数据汇总

1. 任务发布者在任务发布页面查看各子表格的填写状态
2. 点击"汇总导出数据"按钮，将所有已提交的表格数据汇总为一个完整的Excel文件
3. 也可以仅下载对应的单张表格

## 技术方面

### 技术栈

#### 前端 
 - **Vue 3 (v3.5.24)**：采用Composition API，提供高效的组件开发体验 
 - **Vite (v7.2.4)**：快速的构建工具，提供热更新和优化的构建输出 
 - **Element Plus (v2.12.0)**：基于Vue 3的UI组件库，提供丰富的界面组件 
 - **Element Plus Icons (v2.3.2)**：Element Plus配套图标库 
 - **Pinia (v3.0.4)**：轻量级的状态管理库，管理应用的全局状态 
 - **Vue Router (v4.6.4)**：官方路由管理器，实现页面导航 
 - **Axios (v1.5.0)**：HTTP客户端，处理前后端数据交互 
 - **XLSX (v0.18.5)**：表格处理库，实现Excel文件的读取和导出 
 - **Handsontable (v16.2.0)**：强大的表格编辑组件，提供类似Excel的编辑体验 
 - **Spark MD5 (v3.0.2)**：文件哈希计算库，用于文件完整性验证 
 
 #### 后端 
 - **Node.js**：JavaScript运行时，构建高效的后端服务 
 - **Express (v5.2.1)**：简洁的Web应用框架，处理HTTP请求 
 - **SQLite3 (v5.1.7)**：轻量级的关系型数据库，存储任务和表格数据 
 - **CORS (v2.8.5)**：跨域资源共享，支持前后端分离架构 
 - **Body Parser (v2.2.1)**：请求体解析中间件 
 - **Express Rate Limit (v8.2.1)**：请求限流中间件，防止恶意请求 
 - **Winston (v3.19.0)**：日志管理库 
 - **Winston Daily Rotate File (v5.0.0)**：Winston扩展，实现日志按日期轮转

### 项目结构

```
OnlineExcel/
├── backend/                # 后端服务
│   ├── controllers/       # 控制器层，处理请求和响应
│   ├── routes/            # 路由配置，定义API接口
│   ├── services/          # 业务逻辑层，处理核心业务
│   ├── utils/             # 工具函数
│   ├── app.js             # 应用入口
│   ├── db.js              # 数据库配置
│   └── package.json       # 后端依赖配置
├── frontend/              # 前端应用
│   ├── public/            # 静态资源
│   ├── src/               # 源代码
│   │   ├── api/           # API接口定义
│   │   ├── assets/        # 资源文件
│   │   ├── components/    # 可复用组件
│   │   ├── hooks/         # 自定义钩子
│   │   ├── router/        # 路由配置
│   │   ├── stores/        # 状态管理
│   │   ├── utils/         # 工具函数
│   │   ├── views/         # 页面组件
│   │   ├── App.vue        # 根组件
│   │   └── main.js        # 应用入口
│   ├── index.html         # HTML模板
│   ├── package.json       # 前端依赖配置
│   └── vite.config.js     # Vite配置
├── .gitignore             # Git忽略文件
├── Dockerfile             # Docker构建配置
└── README.md              # 项目说明文档
```

### 开发与编译方式

#### 开发环境运行

**环境要求**
- Node.js 16+ 
- npm 或 yarn

**安装与运行**

1. **克隆仓库**

```bash
git clone <仓库地址>
cd OnlineExcel
```

2. **启动后端服务**

```bash
cd backend
npm install
node app.js
```

后端服务默认运行在 http://localhost:5090

3. **启动前端服务**

```bash
cd frontend
npm install
npm run dev
```

前端服务默认运行在 http://localhost:5173

#### 构建生产版本

1. **构建前端**

```bash
cd frontend
npm run build
```

2. **部署前端静态文件**

```bash
# 将前端构建产物复制到后端目录
cp -r frontend/dist/ backend/
```

3. **运行生产版本**

```bash
cd backend
node app.js
```

此时访问 http://localhost:5090 即可使用完整的应用

#### Docker构建与部署

```bash
# 构建Docker镜像
docker build -t onlineexcel .

# 导出Docker镜像（可选）
docker save -o onlineexcel.tar onlineexcel:latest

# 运行Docker容器
docker run -p 5090:5090 -v /etc/localtime:/etc/localtime:ro onlineexcel
```

应用将通过 5090 端口访问
```



#### 开发指南

**前端开发**

```bash
cd frontend
npm install
npm run dev
```

代码修改会实时反映在浏览器中，支持热重载。

**后端开发**

```bash
cd backend
npm install
node app.js
```

建议使用 `nodemon` 实现热重载：

```bash
npm install -g nodemon
nodemon app.js
```

**数据库管理**

- 项目使用SQLite3作为数据库，数据存储在 `backend/tasks.db` 文件中
- 数据库结构会在首次运行时自动创建
- 如需重置数据库，可删除 `tasks.db` 文件后重新启动服务
